# Example - Deploy Image Plugin

Reference: https://book.kubebuilder.io/plugins/available/deploy-image-plugin-v1-alpha

Example of controller generated by`deploy-image/v1-alpha` plugin.

The plugin generates simple controller for deploying container images in cluster, following Kubernetes best practices.

## Initial Scaffolding

```bash
# Bootstrap Project
kubebuilder init --domain example.com --repo example.com/whoami --project-name whoami

# Create API
kubebuilder create api \
    --group example.com \
    --version v1alpha1 \
    --kind Whoami \
    --image=traefik/whoami:latest \
    --run-as-user="1001" \
    --image-container-port="80" \
    --plugins="deploy-image/v1-alpha"
```

## Testing in cluster

First install custom resources and create a sample

```bash
# Install CRDs into the cluster
make install

# Run your controller in the terminal
make run WHOAMI_IMAGE=traefik/whoami:latest

# Deploy sample application
kubectl apply -k config/samples/
```

Expose the deployment (plugin does not create services)
```bash
kubectl expose deployment whoami-sample --port=8080 --target-port 80
```

And test with curl:
```bash
kubectl run --quiet=true -it --rm curl --image=curlimages/curl:latest --restart=Never -- curl http://whoami-sample.default.svc.cluster.local:8080
```
